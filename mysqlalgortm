SELECT 

ROW_NUMBER()OVER (ORDER BY SIRA,ISNULL(KISI_ADI,'2'))S2,
* FROM (	SELECT 
	DENSE_RANK()OVER(ORDER BY CRM_NO)SIRA ,

	* FROM (
		SELECT DISTINCT
		 SB.CRM_NO
		 ,SB.KISI_ADI
		 ,KISI_SOYADI
		 ,SUBE_KODU
		 ,NULL B1
		 ,NULL B2 
		FROM TBLCRM_HR HR (nolock)
		INNER JOIN TBLCRM_KAYIT SB (NOLOCK) on  hr.crm_no=sb.CRM_NO	
		WHERE HR.REC_NO>230972 AND  HR.REC_NO<231050 

	UNION ALL 

		SELECT 
		 SB.CRM_NO
		 ,NULL A1
		 ,NULL B1
		 ,NULL C1
		 ,ADAY_URUN_KODU
		 ,(SELECT STOK_ADI FROM TBLSTOKSB B (NOLOCK) WHERE B.STOK_KODU=HR.ADAY_URUN_KODU) STOK_ADI

		FROM TBLCRM_HR HR (nolock)
		INNER JOIN TBLCRM_KAYIT SB (NOLOCK) on  hr.crm_no=sb.CRM_NO	
		WHERE HR.REC_NO>230972 AND  HR.REC_NO<231050 

	) DATAA  
	)DATA2 ORDER BY SIRA ASC ,S2 DESC 

SELECT 
*
FROM (
		SELECT DISTINCT
		 SB.CRM_NO
		 ,SB.KISI_ADI
		 ,KISI_SOYADI
		 ,SUBE_KODU
		 ,NULL B1
		 ,NULL B2 
		 ,1 SIRA
		FROM TBLCRM_HR HR (nolock)
		INNER JOIN TBLCRM_KAYIT SB (NOLOCK) on  hr.crm_no=sb.CRM_NO	
		WHERE HR.REC_NO>230972 AND  HR.REC_NO<231050 

	UNION ALL 

		SELECT 
		 SB.CRM_NO
		 ,NULL A1
		 ,NULL B1
		 ,NULL C1
		 ,ADAY_URUN_KODU
		 ,(SELECT STOK_ADI FROM TBLSTOKSB B (NOLOCK) WHERE B.STOK_KODU=HR.ADAY_URUN_KODU) STOK_ADI
		 ,2 SIRA
		FROM TBLCRM_HR HR (nolock)
		INNER JOIN TBLCRM_KAYIT SB (NOLOCK) on  hr.crm_no=sb.CRM_NO	
		WHERE HR.REC_NO>230972 AND  HR.REC_NO<231050 

	) DATAA  
	ORDER BY CRM_NO DESC ,SIRA ASC 
